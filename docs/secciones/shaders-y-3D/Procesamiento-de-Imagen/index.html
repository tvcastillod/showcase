<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Procesamiento de Imágenes y máscaras # Introducción # Cuando hablamos de procesamiento de imágenes, nos referimos a un conjunto de técnicas aplicadas a imágenes con el propósito de mejorar la calidad o facilitar la búsqueda de información. En webgl se utiliza la texturización en el procesamiento de imágenes. En este caso estamos interesados en explorar el uso de máscaras para modificar las imágenes con el fin de obtener resultados como una mayor nitidez en la imágen o detectar los bordes de los objetos que se encuentran dentro de esta."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Procesamiento de Imágenes y máscaras # Introducción # Cuando hablamos de procesamiento de imágenes, nos referimos a un conjunto de técnicas aplicadas a imágenes con el propósito de mejorar la calidad o facilitar la búsqueda de información. En webgl se utiliza la texturización en el procesamiento de imágenes. En este caso estamos interesados en explorar el uso de máscaras para modificar las imágenes con el fin de obtener resultados como una mayor nitidez en la imágen o detectar los bordes de los objetos que se encuentran dentro de esta."><meta property="og:type" content="article"><meta property="og:url" content="https://jorodriguezal.github.io/showcase/docs/secciones/shaders-y-3D/Procesamiento-de-Imagen/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-06-16T22:27:26-05:00"><title>Procesamiento De Imagen | Computación Visual</title><link rel=manifest href=/showcase/manifest.json><link rel=icon href=/showcase/favicon.png type=image/x-icon><link rel=stylesheet href=/showcase/book.min.4b35fed0bea034bbc19c89c71e14b73fb9c68cfcc586b9382adfb9b7b103ba06.css integrity="sha256-SzX+0L6gNLvBnInHHhS3P7nGjPzFhrk4Kt+5t7EDugY=" crossorigin=anonymous><script defer src=/showcase/flexsearch.min.js></script>
<script defer src=/showcase/en.search.min.3a8d658c77eb93c7f12a2b8af49a700131e474f288eefb605d9fa61576dbe5a7.js integrity="sha256-Oo1ljHfrk8fxKiuK9JpwATHkdPKI7vtgXZ+mFXbb5ac=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/showcase/><span>Computación Visual</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Secciones</span><ul><li><input type=checkbox id=section-b487fddfe213dc98103a22e30f20cced class=toggle>
<label for=section-b487fddfe213dc98103a22e30f20cced class="flex justify-between"><a href=/showcase/docs/secciones/integrantes/>Integrantes</a></label><ul><li><a href=/showcase/docs/secciones/integrantes/Johan-Steeb-Rodr%C3%ADguez-Alarc%C3%B3n/>Johan Steeb Rodríguez Alarcón</a></li><li><a href=/showcase/docs/secciones/integrantes/Tania-Valentina-Castillo-Delgado/>Tania Valentina Castillo Delgado</a></li><li><a href=/showcase/docs/secciones/integrantes/Mar%C3%ADa-Alejandra-Jim%C3%A9nez-Herrera/>María Alejandra Jiménez Herrera</a></li></ul></li><li><input type=checkbox id=section-812d2262a05fbae8105f136b96854c26 class=toggle>
<label for=section-812d2262a05fbae8105f136b96854c26 class="flex justify-between"><a href=/showcase/docs/secciones/ilusiones-visuales/>Ilusiones Visuales</a></label><ul><li><a href=/showcase/docs/secciones/ilusiones-visuales/v%C3%ADdeo-de-presentaci%C3%B3n/>Vídeo De Presentación</a></li><li><a href=/showcase/docs/secciones/ilusiones-visuales/Cuantificaci%C3%B3n-del-Color/>Cuantificación Del Color</a></li><li><a href=/showcase/docs/secciones/ilusiones-visuales/fen%C3%B3meno-de-masking/>Fenómeno De Masking</a></li><li><a href=/showcase/docs/secciones/ilusiones-visuales/coloraci%C3%B3n/>Coloración</a></li><li><a href=/showcase/docs/secciones/ilusiones-visuales/percepci%C3%B3n-de-profundidad/>Percepción De Profundidad</a></li><li><a href=/showcase/docs/secciones/ilusiones-visuales/bandas-mach/>Bandas Mach</a></li><li><a href=/showcase/docs/secciones/ilusiones-visuales/Coherencia-espacial/>Coherencia Espacial</a></li></ul></li><li><input type=checkbox id=section-659412a241b7c379147b1b576e09e56a class=toggle checked>
<label for=section-659412a241b7c379147b1b576e09e56a class="flex justify-between"><a role=button>Shaders Y 3 D</a></label><ul><li><a href=/showcase/docs/secciones/shaders-y-3D/3d-model/>3d Model</a></li><li><a href=/showcase/docs/secciones/shaders-y-3D/Coloring/>Coloring</a></li><li><a href=/showcase/docs/secciones/shaders-y-3D/Procesamiento-de-Imagen/ class=active>Procesamiento De Imagen</a></li><li><a href=/showcase/docs/secciones/shaders-y-3D/texture-tinting/>Texture Tinting</a></li><li><input type=checkbox id=section-6f3b64a1ece7422886f04b1e6f71f135 class=toggle>
<label for=section-6f3b64a1ece7422886f04b1e6f71f135 class="flex justify-between"><a href=/showcase/docs/secciones/shaders-y-3D/coherencia-espacial/>Coherencia Espacial</a></label><ul><li><a href=/showcase/docs/secciones/shaders-y-3D/coherencia-espacial/Shaders/>Shaders</a></li><li><a href=/showcase/docs/secciones/shaders-y-3D/coherencia-espacial/Lineal/>Lineal</a></li></ul></li><li><a href=/showcase/docs/secciones/shaders-y-3D/posteffects/>Posteffects</a></li><li><a href=/showcase/docs/secciones/shaders-y-3D/procedural_texturing/>Procedural Texturing</a></li></ul></li><li><input type=checkbox id=section-6afa5302a62ba217d5088de37992068a class=toggle>
<label for=section-6afa5302a62ba217d5088de37992068a class="flex justify-between"><a href=/showcase/docs/secciones/p5/>P5</a></label><ul><li><a href=/showcase/docs/secciones/p5/iframe/>Iframe</a></li><li><a href=/showcase/docs/secciones/p5/div/>Div</a></li></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/showcase/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Procesamiento De Imagen</strong>
<label for=toc-control><img src=/showcase/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#procesamiento-de-imágenes-y-máscaras>Procesamiento de Imágenes y máscaras</a><ul><li><a href=#introducción>Introducción</a><ul><li><a href=#antecedentes-y-trabajo-previo>Antecedentes y trabajo previo</a></li></ul></li><li><a href=#ejercicio>Ejercicio</a><ul><li><a href=#solución>Solución</a></li><li><a href=#código>Código</a></li></ul></li><li><a href=#conclusión>Conclusión</a><ul><li><a href=#trabajo-futuro>Trabajo Futuro</a></li></ul></li><li><a href=#referencias>Referencias</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=procesamiento-de-imágenes-y-máscaras>Procesamiento de Imágenes y máscaras
<a class=anchor href=#procesamiento-de-im%c3%a1genes-y-m%c3%a1scaras>#</a></h1><h2 id=introducción>Introducción
<a class=anchor href=#introducci%c3%b3n>#</a></h2><blockquote><div style=text-align:justify><p>Cuando hablamos de procesamiento de imágenes, nos referimos a un conjunto de técnicas aplicadas a imágenes con el propósito de mejorar la calidad o facilitar la búsqueda de información. En <a href=https://en.wikipedia.org/wiki/OpenGL_Shading_Language>webgl</a> se utiliza la texturización en el procesamiento de imágenes. En este caso estamos interesados en explorar el uso de máscaras para modificar las imágenes con el fin de obtener resultados como una mayor nitidez en la imágen o detectar los bordes de los objetos que se encuentran dentro de esta.</p></div></blockquote><h3 id=antecedentes-y-trabajo-previo>Antecedentes y trabajo previo
<a class=anchor href=#antecedentes-y-trabajo-previo>#</a></h3><blockquote><div style=text-align:justify><p>El procesamiento de imágenes es ampliamente usado en distintos campos de estudio desde la industria del entretenimiento, hasta el campo de la medicina. Algunos de los usos más comunes son: el suavizado de imágenes, la eliminación de ruido, la detección de bordes, entre otros. Este procesamiento permite realzar los detalles de una imagen, lo cual permite obtener información adicional sobre esta. Con el uso de máscaras, herramientas de luminosidad y magnificación, podemos procesar imágenes. Y con el uso de shaders y texturización podemos facilitar aún más este proceso.</p></div><h4 id=trabajo-previo>Trabajo previo
<a class=anchor href=#trabajo-previo>#</a></h4><div style=text-align:justify>A continuación se listan algunos trabajos previos realizados sobre este tema:<ul><li><a href=https://www.photo-kako.com/en/convolution/>Photokako</a> Es una herramienta que nos permite aplicar diferentes máscaras, con matrices definidas por el usuario, o predeterminados con efectos como detección de bordes.</li><li><a href=https://planetcalc.com/9313/>Planetcalc</a> Esta página ofrece numerosas herramientas y una de ellas permite procesar imágenes con los efectos más comunes como el suavizado y difuminado de imágenes.</li></ul></div></blockquote><h2 id=ejercicio>Ejercicio
<a class=anchor href=#ejercicio>#</a></h2><blockquote class="book-hint info"><p>Implementar una aplicación de procesamiento de imagen/ video que utilice diferentes <a href=https://en.wikipedia.org/wiki/Kernel_%28image_processing%29>máscaras</a>, incluyendo otros tamaños de kernel diferente a 3x3, y:</p><ul><li>Una herramienta base de <a href=https://en.wikipedia.org/wiki/Region_of_interest>región de interés</a> para aplicar selectivamente una máscara determinada. Sugerencia: las regiones circulares alrededor del puntero del ratón son prácticas y bastante sencillas de implementar mediante la <a href="https://thebookofshaders.com/glossary/?search=distance">distancia glsl</a>.</li><li>Una herramienta de lupa. Requiere un poco de investigación. Por ejemplo, se puede buscar en <a href="https://www.shadertoy.com/results?query=magnifier">shadertoy</a>.</li><li>Integrar <a href=https://visualcomputing.github.io/docs/shaders/texturing/#texture-sampling>luma</a> y otras <a href=https://en.wikipedia.org/wiki/HSL_and_HSV#Disadvantages>herramientas de brillo de coloración</a>.</li></ul></blockquote><h3 id=solución>Solución
<a class=anchor href=#soluci%c3%b3n>#</a></h3><blockquote><h4 id=texturado>Texturado
<a class=anchor href=#texturado>#</a></h4><div style=text-align:justify><p>Para el procesamiento de imágenes, se utilizará el concepto de texturización, implementado con shaders. Cuando hablamos de textura nos referimos a un mapa de bits o una textura procedimental (una imagen) la cual se mapea sobre una superficie de una forma específica. Para manipular una imagen con el uso de shaders, es necesario utilizar la función <code>texture2D(texture, texcoords)</code> la cual muestrea la imagen <code>texture</code> en las coordenadas de textura <code>texcoords</code>.</p></div><h4 id=máscaras>Máscaras
<a class=anchor href=#m%c3%a1scaras>#</a></h4><div style=text-align:justify><p>Para crear diferentes efectos en las imágenes, utilizaremos máscaras. Una máscara, kernel o matriz de convolución es una matriz la cual se opera con la información de los pixeles de la imagen con el fin de lograr diferentes efectos de enfoque, desenfoque, nitidez, detección de bordes, entre otros. El proceso se compone de 3 elementos:</p><ul><li>Una imagen de entrada de dimensión igual o mayor a la de la máscara que se va a aplicar.</li><li>Una máscara de convolución, es decir, una matriz cuadrada de dimensión impar.</li><li>La imagen de salida del mismo tamaño que la imagen original.</li></ul><p>El procedimiento consiste en aplicar la máscara a cada uno de los pixeles de la imagen. La idea es multiplicar componente a componente la matriz de convolución por la matriz que contiene al pixel actual y los pixeles que lo rodean, para después sumar los valores y obtener el nuevo valor del pixel en la imagen procesada. En la figura 1 se puede ver una ilustración de este proceso.</p><p align=center><img src=/showcase/img/convolution.png alt width=400px><br>Fig.1 - Operación de convolución</p><p>A continuación veremos algunos ejemplos de máscaras y los efectos que tienen sobre una imagen.</p><p align=center><img src=/showcase/img/convol1.png alt width=610px><br>Fig.2 - Máscaras IDENTITY, RIDGE y SHARPEN</p><p>Primero tenemos la máscara <code>IDENTITY</code> o identidad, esta matriz solo le da peso al pixel del centro que es el pixel a modificar, por lo que no tiene ningún efecto sobre la imagen, ya que simplemente mapea cada pixel inicial a la imagen resultante. Segundo, tenemos la máscara <code>RIDGE</code> o de bordes, esta matriz le da un peso negativo a los pixeles que rodean al pixel principal <strong><em>p</em></strong>, esto con el fin de que para valores muy cercanos a <strong><em>p</em></strong> (es decir, cuando no hay bordes y la superficie es más bien homogénea), el resultado es pequeño tomando colores oscuros; mientras que para valores lejanos a <strong><em>p</em></strong> (es decir, cuando hay presencia de bordes y hay un contraste significativo de colores), el resultado es mayor y toma colores más claros, haciendo que estos bordes destaquen en la imagen final, por esta razón con esta máscara se pueden detectar los bordes de una imagen. Tercero, tenemos la máscara <code>SHARPEN</code>, esta matriz le da peso únicamente a los pixeles que están abyacentes al pixel principal <strong><em>p</em></strong>, esto da como resultado una imagen más nítida donde los detalles, como los borden, son resaltados.</p><p align=center><img src=/showcase/img/convol2.png alt width=610px><br>Fig.3 - Máscaras SHARPEN2, GAUSSIAN BLUR y EMBOSS</p><p>Las máscaras mencionadas anteriormente pueden tener algunas variantes que generan resultados ligeramente distintos en la imagen final, por ejemplo, tenemos una segunda versión de la máscara de nitidez, la cual llamamos <code>SHARPEN2</code>, esta le da un poco más de peso al pixel <strong><em>p</em></strong> haciendo que la nitidez de la imagen sea mucho mayor que la de la otra máscara, en la figura 3 podemos ver cómo algunos detalles como el pelaje del animal es más notorio en ciertas zonas. También tenemos la máscara <code>GAUSSIAN BLUR</code> o de difuminado Gaussiano la cuál nos permise suavizar la imágenes generando un efecto de desenfoque que hace ver a la imagen un poco borrosa, aquí vemos que la matriz es más grande con un tamaño de 5x5 la cual determina el grado de desenfoque que se aplica (si tomaramos una matriz más grande la imagen final se vería aún más borrosa). Por último, tenemos la máscara <code>EMBOSS</code> o de relieve, en este caso la matriz le da un poco más de peso a los pixeles que hay alrededor de <strong><em>p</em></strong> resaltando aún más los bordes de la imagen, dando a la imagen un poco de relieve.</p><p>Adicional a las máscaras existen otras herramientas que nos permiten ver detalles específicos de las imágenes, sin necesidad de aplicar el filtro a la imágen completa. Esto nos sirve para cuando solo estamos interesados en analizar solo una parte de la imagen o hacer comparaciones con la imagen original. A continuación hablaremos de 2 de estas herramientas.</p></div><h4 id=herramienta-de-región-de-interés-roi-y-magnificación>Herramienta de región de interés (ROI) y magnificación
<a class=anchor href=#herramienta-de-regi%c3%b3n-de-inter%c3%a9s-roi-y-magnificaci%c3%b3n>#</a></h4><div style=text-align:justify><p align=center><img src=/showcase/img/tools1.png alt width=400px><br>Fig.4 - Región de interés (ROI) y magnificación</p><p>Por un lado, tenemos la herramienta de región de interés o en inglés Region Of Interest (ROI). Esta consiste en tomar una sección de la imagen la cual se quiere detallar o analizar. Estas se suelen usar en distintos ámbitos, como por ejemplo en imágenes médicas cuando se quiere analizar los límites de un tumor. En la figura 4 podemos ver en la imagen izquierda que se aplicó la máscara de <strong><em>RIDGE</em></strong> únicamente en una parte de la imagen, en este caso, una parte de las alas del animal. Por otro lado, tenemos la herramienta de magnificación la cuál es básicamente una lupa que nos permite ver una parte de la imagen más de cerca (con más zoom). En la figura 4 podemos ver a la derecha que se hizo un acercamiento a la cabeza del pájaro, lo cual nos permite ver con más detalle a este además de ver mejor cómo actúa la máscara de <strong><em>difuminado Gaussiano</em></strong>.</p><p>Además de las herramientas mencionadas anteriormente, tenemos otras que nos permiten manipular el brillo de una imagen, esto con el fin de resaltar ciertar zonas de la imagen donde hay una mayor luminosidad. A continuación mencionamos 4 métodos para modificar el brillo de una imagen.</p></div><h4 id=herramienta-de-brillo>Herramienta de brillo
<a class=anchor href=#herramienta-de-brillo>#</a></h4><div style=text-align:justify><p>Es importante mencionar que existen representaciones alternas al modelo de color RGB, las cuales fueron diseñadas con el fin de ajustarse más a la forma en la que la visión humana percibe el color. Cada modelo destaca atributos diferentes de color, como la intensidad o luminosidad, algunos de los modelos más conocidos son el HSL (Hue, Saturation, Lightness) y el HSV (Hue, Saturation, Value). Veamos cómo está definido cada uno y qué efecto tiene en una imagen. Primero, tenemos la opción de <code>INTENSITY</code> o intensidad, esta se refiere al brillo u opacidad de un color, si es más brillante es más intenso,y si es más oscuro tiene menor intensidad. Esta se calcula tomando el promedio de los valores RGB <code>I = (R + G + B) / 3</code> lo cual nos dá como resultado una imagen donde la intensidad de los colores está balanceada como podemos ver en la primera imagen de la figura 5. Segundo, tenemos la opción de <code>VALUE</code> o valor, la cual nos dice que tan claro u oscuro es un color, este toma el valor máximo de los valores RGB <code>V = máx {R, G, B}</code>. Recordemos que entre mayor es el número el color es más claro y por ende más brillante, por lo cual esta opción nos permite hacer la imagen más brillante en las zonas donde los colores son más claros como se puede observar en la segunda imagen de la figura 5.</p><p align=center><img src=/showcase/img/tools2.png alt width=630px><br>Fig.5 - Herramientas de brillo Intensity, Value, Lightness y Luma</p><p>Tercero, tenemos la opción de <code>LIGHTNESS</code> la cual se define como el promedio de la mayor y menor componente de los valores RGB, lo cual da como resultado los componentes medios de la paleta de colores, es decir, nos ayuda a balancear el brillo de una imagen al igual que el modelo <strong><em>INTENSITY</em></strong>. En la tercera imagen de la figura 5 podemos ver que el resultado es muy similar el de la primera imagen. Cuarto, tenemos la opción de <code>LUMA</code> la cual es definida como la media ponderada de los valores RGB con corrección gamma, es decir, esta se base en la contribución de cada canal a la luminosidad percibida. Los factores de cada componente pueden variar dependiendo el estándar que se utilice como referencia, en este caso se toma <strong><em>SDTV (Standard Definition Television)</em></strong> la cual se define como <code>Y = 0.2989 R + 0.5870 G + 0.1140 B</code>, y podemos ver el resultado en la última imagen de la figura 5, allí podemos notar que también se llogra un balance pero destacando ligeramente las zonas donde los colores son más claros y brillantes.</p><blockquote><p>A continuación tenemos la implementación de toda la información dada anteriormente. En primera instancia tenemos la opción de escoger entre 6 diferentes máscaras, incluyendo algunas con una tamaño diferente al usual de 3x3. Además, tenemos la opción de usar herramientas de magnificación y región de interés, a las cuales se les pueden modificar el tamaño de la región que se quiere observas y para el caso de la lupa también se puede ajustar el zoom. Finalmente, tenemos la opción de aplicar 4 modelos diferentes de iluminación, los cuales se muestra en escala de grises ya que el valor resultante se toma para los tres canales de color.</p><iframe id=img_process style=width:575px;height:455px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            <script src=https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5.treegl.min.js></script>
            <script src=https://freshfork.github.io/p5.EasyCam/p5.easycam.js></script>
            
            
            
            
            
            <script src=/showcase/sketches/image_processing/img_process.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe></blockquote></div></blockquote><h3 id=código>Código
<a class=anchor href=#c%c3%b3digo>#</a></h3><blockquote><p><details><summary>Código completo la implementación de las diferentes herramientas de procesamiento de imagen</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>img</span>, <span style=color:#a6e22e>myShader</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>mode</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>mask5</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>tool</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>btool</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>zoom</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.3</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>preload</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>img</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>&#34;/showcase/sketches/image_processing/anim2.png&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>myShader</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadShader</span>(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;/showcase/sketches/image_processing/shader.vert&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;/showcase/sketches/image_processing/shader.frag&#34;</span>
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>400</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>input</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createFileInput</span>(<span style=color:#a6e22e>handleFile</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>height</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>15</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectMode</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSelect</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>410</span>, <span style=color:#ae81ff>35</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#34;IDENTITY&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#34;RIDGE&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#34;SHARPEN&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#34;SHARPEN2&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#34;GAUSSIAN BLUR&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#34;EMBOSS&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>changed</span>(<span style=color:#a6e22e>mySelectEvent</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>selected</span>(<span style=color:#e6db74>&#34;RIDGE&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectTool</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSelect</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectTool</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>410</span>, <span style=color:#ae81ff>90</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectTool</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#34;NONE&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectTool</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#34;ROI&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectTool</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#34;MAGNIFIER&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectTool</span>.<span style=color:#a6e22e>changed</span>(<span style=color:#a6e22e>mySelectEvent2</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectTool</span>.<span style=color:#a6e22e>selected</span>(<span style=color:#e6db74>&#34;ROI&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>slider</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSlider</span>(<span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>80</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>slider</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>410</span>, <span style=color:#ae81ff>140</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>slider</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#34;width&#34;</span>, <span style=color:#e6db74>&#34;100px&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sliderZoom</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSlider</span>(<span style=color:#ae81ff>0.1</span>, <span style=color:#ae81ff>0.6</span>, <span style=color:#ae81ff>0.3</span>, <span style=color:#ae81ff>0.05</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sliderZoom</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>410</span>, <span style=color:#ae81ff>190</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sliderZoom</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#34;width&#34;</span>, <span style=color:#e6db74>&#34;100px&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>radio</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createRadio</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>radio</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#34;1&#34;</span>, <span style=color:#e6db74>&#34; none  \n&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>radio</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#34;2&#34;</span>, <span style=color:#e6db74>&#34;intensity&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>radio</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#34;3&#34;</span>, <span style=color:#e6db74>&#34;value\n  &#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>radio</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#34;4&#34;</span>, <span style=color:#e6db74>&#34;lightness&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>radio</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#e6db74>&#34;luma&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>radio</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#34;width&#34;</span>, <span style=color:#e6db74>&#34;80px&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>radio</span>.<span style=color:#a6e22e>selected</span>(<span style=color:#e6db74>&#34;1&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>radio</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>408</span>, <span style=color:#ae81ff>280</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>text1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSpan</span>(<span style=color:#e6db74>&#34;Mask&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>text1</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>410</span>, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>text2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSpan</span>(<span style=color:#e6db74>&#34;Tool&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>text2</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>410</span>, <span style=color:#ae81ff>65</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>text3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSpan</span>(<span style=color:#e6db74>&#34;Size&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>text3</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>410</span>, <span style=color:#ae81ff>120</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>text4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSpan</span>(<span style=color:#e6db74>&#34;Zoom&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>text4</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>410</span>, <span style=color:#ae81ff>170</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>text5</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSpan</span>(<span style=color:#e6db74>&#34;Brightness&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>text5</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>410</span>, <span style=color:#ae81ff>250</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>mask_</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.0</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>mask2</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>6</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>16</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>24</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>16</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>6</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>24</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>36</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>24</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>6</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>16</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>24</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>16</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>6</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>256</span>,
</span></span><span style=display:flex><span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>225</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>mode</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mask_</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>1.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.0</span>];
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mask_</span> <span style=color:#f92672>=</span> [<span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#ae81ff>8.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>];
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mask_</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#ae81ff>5.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#ae81ff>0.0</span>];
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>4</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mask_</span> <span style=color:#f92672>=</span> [<span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#ae81ff>9.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span>];
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>5</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mask2</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>7</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>16</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>26</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>16</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>7</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>26</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>41</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>26</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>7</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>16</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>26</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>16</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>7</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>4</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>273</span>,
</span></span><span style=display:flex><span>      ];
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>6</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mask2</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>2</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>      ];
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>shader</span>(<span style=color:#a6e22e>myShader</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;texture&#34;</span>, <span style=color:#a6e22e>img</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;mask5&#34;</span>, <span style=color:#a6e22e>mask5</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;mask&#34;</span>, <span style=color:#a6e22e>mask_</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;mask2&#34;</span>, <span style=color:#a6e22e>mask2</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;texOffset&#34;</span>, [<span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>width</span>, <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>height</span>]);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;mousePos&#34;</span>, [
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mouseX</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>pixelDensity</span>(),
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>height</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>mouseY</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>pixelDensity</span>(),
</span></span><span style=display:flex><span>  ]);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rect</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;radius&#34;</span>, <span style=color:#a6e22e>slider</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;tool&#34;</span>, <span style=color:#a6e22e>tool</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;btool&#34;</span>, <span style=color:#a6e22e>radio</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// valores adaptados de https://gamedevserj.github.io/godot-magnifying-glass-tutorial.html
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>zoom</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sliderZoom</span>.<span style=color:#a6e22e>value</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>xOffset</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>zoom</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>mouseX</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>width</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>yOffset</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>zoom</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>mouseY</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>height</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tiling</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>zoom</span>, <span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>zoom</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>offset</span> <span style=color:#f92672>=</span> [<span style=color:#a6e22e>xOffset</span>, <span style=color:#a6e22e>yOffset</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;tiling&#34;</span>, <span style=color:#a6e22e>tiling</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;offset&#34;</span>, <span style=color:#a6e22e>offset</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleFile</span>(<span style=color:#a6e22e>file</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;image&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>img</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>&#34;El archivo seleccionado no es una imagen.&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>mySelectEvent</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;IDENTITY&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mode</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mask5</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;RIDGE&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mode</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mask5</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;SHARPEN&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mode</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mask5</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;SHARPEN2&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mode</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mask5</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;GAUSSIAN BLUR&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mode</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mask5</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>selectMode</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;EMBOSS&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mode</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mask5</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>mySelectEvent2</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>selectTool</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;NONE&#34;</span>) <span style=color:#a6e22e>tool</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>selectTool</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ROI&#34;</span>) <span style=color:#a6e22e>tool</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>selectTool</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;MAGNIFIER&#34;</span>) <span style=color:#a6e22e>tool</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>s1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>sketch</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sketch</span>.<span style=color:#a6e22e>setup</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>canvas1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sketch</span>.<span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>570</span>, <span style=color:#ae81ff>50</span>, <span style=color:#a6e22e>sketch</span>.<span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>canvas1</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>400</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sketch</span>.<span style=color:#a6e22e>draw</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sketch</span>.<span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>230</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>(<span style=color:#a6e22e>s1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>s2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>sketch</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sketch</span>.<span style=color:#a6e22e>setup</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>canvas1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sketch</span>.<span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>170</span>, <span style=color:#ae81ff>400</span>, <span style=color:#a6e22e>sketch</span>.<span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>canvas1</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sketch</span>.<span style=color:#a6e22e>draw</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sketch</span>.<span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>230</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>(<span style=color:#a6e22e>s2</span>);
</span></span></code></pre></div></div></details></br><details><summary>vertex shader (genérico)</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>attribute</span> <span style=color:#a6e22e>vec3</span> <span style=color:#a6e22e>aPosition</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>attribute</span> <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>aTexCoord</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>varying</span> <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>vTexCoord</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// flip the coordinates
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#a6e22e>aTexCoord</span>.<span style=color:#a6e22e>s</span>, <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>aTexCoord</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>positionVec4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>aPosition</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>positionVec4</span>.<span style=color:#a6e22e>xy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>positionVec4</span>.<span style=color:#a6e22e>xy</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2.0</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1.0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gl_Position</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>positionVec4</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></details></br><details><summary>fragment shader</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>precision</span> <span style=color:#a6e22e>mediump</span> <span style=color:#66d9ef>float</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#a6e22e>sampler2D</span> <span style=color:#a6e22e>texture</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>texOffset</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>mask</span>[<span style=color:#ae81ff>9</span>];
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>mask2</span>[<span style=color:#ae81ff>25</span>];
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#a6e22e>bool</span> <span style=color:#a6e22e>mask5</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>mousePos</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>tool</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>btool</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>radius</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tiling</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>uniform</span> <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>offset</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>varying</span> <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>vTexCoord</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>color_mask</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>color_normal</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>color_base</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>applyMask2</span>(<span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>vTexCoord</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc0</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(             <span style=color:#ae81ff>0.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>+</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>+</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc5</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc6</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc7</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(             <span style=color:#ae81ff>0.0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc8</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>+</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc9</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>+</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc10</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>,              <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc11</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>,              <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc12</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(             <span style=color:#ae81ff>0.0</span>,              <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc13</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>+</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>,              <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc14</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>+</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>,              <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc15</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>+</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc16</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>+</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc17</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(             <span style=color:#ae81ff>0.0</span>, <span style=color:#f92672>+</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc18</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>+</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>+</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc19</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>+</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>+</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc20</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>+</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc21</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>+</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc22</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(             <span style=color:#ae81ff>0.0</span>, <span style=color:#f92672>+</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc23</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>+</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>+</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc24</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>+</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>+</span><span style=color:#ae81ff>2.0</span><span style=color:#f92672>*</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 2. Sample texel neighbours within the rgba array
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>25</span>];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc2</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc3</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc4</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>5</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc5</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>6</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc6</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>7</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc7</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>8</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc8</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>9</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc9</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>10</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc10</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>11</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc11</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>12</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc12</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>13</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc13</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>14</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc14</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>15</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc15</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>16</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc16</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>17</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc17</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>18</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc18</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>19</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc19</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>20</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc20</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>21</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc21</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>22</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc22</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>23</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc23</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>24</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc24</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 3. Apply convolution kernel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>convolution</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>25</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>convolution</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>rgba</span>[<span style=color:#a6e22e>i</span>]<span style=color:#f92672>*</span><span style=color:#a6e22e>mask2</span>[<span style=color:#a6e22e>i</span>];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>color_mask</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>convolution</span>.<span style=color:#a6e22e>rgb</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>color_mask</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>applyMask</span>(<span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>vTexCoord</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 1. Use offset to move along texture space.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// In this case to find the texcoords of the texel neighbours.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc0</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(         <span style=color:#ae81ff>0.0</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>+</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>,          <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// origin (current fragment texcoords)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(         <span style=color:#ae81ff>0.0</span>,          <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc5</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>+</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>,          <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc6</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>+</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc7</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(         <span style=color:#ae81ff>0.0</span>, <span style=color:#f92672>+</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc8</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>+</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>+</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 2. Sample texel neighbours within the rgba array
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>9</span>];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc2</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc3</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc4</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>5</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc5</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>6</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc6</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>7</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc7</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>8</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc8</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 3. Apply convolution kernel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>convolution</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>9</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>convolution</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>rgba</span>[<span style=color:#a6e22e>i</span>]<span style=color:#f92672>*</span><span style=color:#a6e22e>mask</span>[<span style=color:#a6e22e>i</span>];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>color_mask</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>convolution</span>.<span style=color:#a6e22e>rgb</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>color_mask</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>intensity</span>(<span style=color:#a6e22e>vec3</span> <span style=color:#a6e22e>texel</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>r</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>g</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>b</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>3.0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>value</span>(<span style=color:#a6e22e>vec3</span> <span style=color:#a6e22e>texel</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>g</span>), <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>b</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>lightness</span>(<span style=color:#a6e22e>vec3</span> <span style=color:#a6e22e>texel</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>mx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>g</span>), <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>b</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>mn</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>g</span>), <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>b</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>mx</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>mn</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>2.0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>vec3</span> <span style=color:#a6e22e>texel</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0.299</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>r</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.587</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>g</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.114</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>mask5</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_mask</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>applyMask2</span>(<span style=color:#a6e22e>vTexCoord</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_normal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>vTexCoord</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_base</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>applyMask2</span>(<span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>tiling</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>offset</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_mask</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>applyMask</span>(<span style=color:#a6e22e>vTexCoord</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_normal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>vTexCoord</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_base</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>applyMask</span>(<span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>tiling</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>offset</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>btool</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_mask</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>vec3</span>(<span style=color:#a6e22e>intensity</span>(<span style=color:#a6e22e>color_mask</span>.<span style=color:#a6e22e>xyz</span>)),<span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_normal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>vec3</span>(<span style=color:#a6e22e>intensity</span>(<span style=color:#a6e22e>color_normal</span>.<span style=color:#a6e22e>xyz</span>)),<span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_base</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>vec3</span>(<span style=color:#a6e22e>intensity</span>(<span style=color:#a6e22e>color_base</span>.<span style=color:#a6e22e>xyz</span>)),<span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>btool</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_mask</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>vec3</span>(<span style=color:#a6e22e>value</span>(<span style=color:#a6e22e>color_mask</span>.<span style=color:#a6e22e>xyz</span>)),<span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_normal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>vec3</span>(<span style=color:#a6e22e>value</span>(<span style=color:#a6e22e>color_normal</span>.<span style=color:#a6e22e>xyz</span>)),<span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_base</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>vec3</span>(<span style=color:#a6e22e>value</span>(<span style=color:#a6e22e>color_base</span>.<span style=color:#a6e22e>xyz</span>)),<span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>btool</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>4</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_mask</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>vec3</span>(<span style=color:#a6e22e>lightness</span>(<span style=color:#a6e22e>color_mask</span>.<span style=color:#a6e22e>xyz</span>)),<span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_normal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>vec3</span>(<span style=color:#a6e22e>lightness</span>(<span style=color:#a6e22e>color_normal</span>.<span style=color:#a6e22e>xyz</span>)),<span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_base</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>vec3</span>(<span style=color:#a6e22e>lightness</span>(<span style=color:#a6e22e>color_base</span>.<span style=color:#a6e22e>xyz</span>)),<span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>btool</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>5</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_mask</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>vec3</span>(<span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>color_mask</span>.<span style=color:#a6e22e>xyz</span>)),<span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_normal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>vec3</span>(<span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>color_normal</span>.<span style=color:#a6e22e>xyz</span>)),<span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_base</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>vec3</span>(<span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>color_base</span>.<span style=color:#a6e22e>xyz</span>)),<span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>mask5</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_mask</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>applyMask2</span>(<span style=color:#a6e22e>vTexCoord</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_normal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>vTexCoord</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_base</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>applyMask2</span>(<span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>tiling</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>offset</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_mask</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>applyMask</span>(<span style=color:#a6e22e>vTexCoord</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_normal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>vTexCoord</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color_base</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>applyMask</span>(<span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>tiling</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>offset</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// cálculo de la distancia tomado de https://stackoverflow.com/questions/45270803/webgl-shader-to-color-the-texture-according-to-mouse-position
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>dist</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>distance</span>(<span style=color:#a6e22e>mousePos</span>, <span style=color:#a6e22e>gl_FragCoord</span>.<span style=color:#a6e22e>xy</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>mixAmount</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>clamp</span>((<span style=color:#a6e22e>dist</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>radius</span>) , <span style=color:#ae81ff>0.</span>, <span style=color:#ae81ff>1.</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>tool</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gl_FragColor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>color_mask</span>;
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>tool</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gl_FragColor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mix</span>(<span style=color:#a6e22e>color_mask</span>, <span style=color:#a6e22e>color_normal</span>, <span style=color:#a6e22e>mixAmount</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gl_FragColor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mix</span>(<span style=color:#a6e22e>color_base</span>, <span style=color:#a6e22e>color_mask</span>, <span style=color:#a6e22e>mixAmount</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></details></p><div style=text-align:justify><p>A continuación se muestra de forma más detallada las partes claves del código anterior.
<details open><summary>parámetros que se envían a los shaders</summary><div class=markdown-inner><p>Veamos los parámetros que se necesitan enviar al fragment shader. Para aplicar las máscaras se necesita la imagen <code>texture</code> la cual es recibida en el shader como un elemento de tipo <code>sampler2D</code>, es decir una textura, la cual posteriormente es mapeada con la función <code>texture2D()</code>. Además, tenemos la matriz de convolución que corresponde a un vector de tamaño 9(3x3) <code>mask</code> o 25(5x5) <code>mask2</code>, estas son asignadas a dos variables diferentes. También es necesario definir <code>texOffset</code> la cual nos ayuda a obtener los pixeles vecinos del pixel principal cuando se aplica la máscara. Para las herramientas de ROI y magnificación necesitamos los datos de la posición del mouse <code>mousePos</code>, además del radio <code>radius</code> que indica el tamaño de la región que se quiere observar, y en el caso de la lupa se necesitan <code>tiling</code> y <code>offset</code> que ayudan a enfocar y hacer zoom a la región deseada. Finalmente se utiliza <code>tool</code> y <code>btool</code> para indicar qué herramienta de detalle y luminosidad se quiere utilizar.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// dentro de la función draw()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>shader</span>(<span style=color:#a6e22e>myShader</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;texture&#34;</span>, <span style=color:#a6e22e>img</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;mask5&#34;</span>, <span style=color:#a6e22e>mask5</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;mask&#34;</span>, <span style=color:#a6e22e>mask_</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;mask2&#34;</span>, <span style=color:#a6e22e>mask2</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;texOffset&#34;</span>, [<span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>width</span>, <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>height</span>]);
</span></span><span style=display:flex><span><span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;mousePos&#34;</span>, [
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mouseX</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>pixelDensity</span>(),
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>height</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>mouseY</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>pixelDensity</span>(),
</span></span><span style=display:flex><span>]);
</span></span><span style=display:flex><span><span style=color:#a6e22e>rect</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;radius&#34;</span>, <span style=color:#a6e22e>slider</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;tool&#34;</span>, <span style=color:#a6e22e>tool</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;btool&#34;</span>, <span style=color:#a6e22e>radio</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// valores adaptados de https://gamedevserj.github.io/godot-magnifying-glass-tutorial.html
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>zoom</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sliderZoom</span>.<span style=color:#a6e22e>value</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>xOffset</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>zoom</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>mouseX</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>width</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>yOffset</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>zoom</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>mouseY</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>height</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tiling</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>zoom</span>, <span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>zoom</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>offset</span> <span style=color:#f92672>=</span> [<span style=color:#a6e22e>xOffset</span>, <span style=color:#a6e22e>yOffset</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;tiling&#34;</span>, <span style=color:#a6e22e>tiling</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>myShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#34;offset&#34;</span>, <span style=color:#a6e22e>offset</span>);
</span></span></code></pre></div></div></details></br><details open><summary>código de shaders</summary><div class=markdown-inner><p>Para el vertex shader el único dato relevante es que debemos pasar información sobre las coordenadas de textura <code>aTexCoord</code>, que nos permite definir cómo se mapea una imagen en una superficie. Y pasamos este dato al fragment shader como <code>vTexCoord</code>. Además, realizamos una operación que nos permite voltear la imagen, ya que si no se hace, la imagen se muestra al revéz.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>attribute</span> <span style=color:#a6e22e>vec3</span> <span style=color:#a6e22e>aPosition</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>attribute</span> <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>aTexCoord</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>varying</span> <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>vTexCoord</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// flip the coordinates
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#a6e22e>aTexCoord</span>.<span style=color:#a6e22e>s</span>, <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>aTexCoord</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Para el fragment shader tenemos tres secciones importantes:</p><ol><li>La función <code>vec4 applyMask2(vec2 vTexCoord)</code> la cual la operación entre los pixeles de la textura <code>texture</code> y la máscara <code>mask[9]</code>. El proceso consiste en: primero se hayan los valores de los pixeles que rodean al pixel principal, para esto usamos el parámetro de <code>texOffset</code> que nos permite movernos en el espacio de la textura, segundo almacemos estos datos en un array con los valores <code>rgba</code> de cada pixel, tercero aplicamos la máscara de convolución con ayuda de un for que recorre ambos arrays mientras opera los valores y almacena la suma en un vector de 4 posiciones <code>convolution</code> con el resultado final del color (RGBA) del pixel.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>applyMask</span>(<span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>vTexCoord</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 1. Use offset to move along texture space.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// In this case to find the texcoords of the texel neighbours.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc0</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// origin (current fragment texcoords)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(         <span style=color:#ae81ff>0.0</span>,          <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec2</span> <span style=color:#a6e22e>tc8</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vec2</span>(<span style=color:#f92672>+</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>s</span>, <span style=color:#f92672>+</span><span style=color:#a6e22e>texOffset</span>.<span style=color:#a6e22e>t</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 2. Sample texel neighbours within the rgba array
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>9</span>];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc0</span>);
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rgba</span>[<span style=color:#ae81ff>8</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>texture2D</span>(<span style=color:#a6e22e>texture</span>, <span style=color:#a6e22e>tc8</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 3. Apply convolution kernel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>convolution</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>9</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>convolution</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>rgba</span>[<span style=color:#a6e22e>i</span>]<span style=color:#f92672>*</span><span style=color:#a6e22e>mask</span>[<span style=color:#a6e22e>i</span>];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vec4</span> <span style=color:#a6e22e>color_mask</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec4</span>(<span style=color:#a6e22e>convolution</span>.<span style=color:#a6e22e>rgb</span>, <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>color_mask</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Se tomó como referencia el código de <a href=https://visualcomputing.github.io/docs/shaders/image_processing/>image processing</a> con el procedimiento base para una máscara de 3x3. Este procedimiento se adaptó para una máscara de 5x5, la cual se puede detallar en el código completo del fragment shader.</p><ol start=2><li>Las funciones para aplicar las herramientas de brillo. Estas son <code>intensity</code>, <code>value</code>, <code>lightness</code> y <code>luma</code>, cada una recibe como parámetro un vector <code>texel</code> de 3 posiciones que corresponden al color RGB del pixel de la textura o texel, luego se realiza la operación correspondiente y se devuelve un valor de tipo <em>float</em>.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>intensity</span>(<span style=color:#a6e22e>vec3</span> <span style=color:#a6e22e>texel</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>r</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>g</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>b</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>3.0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>value</span>(<span style=color:#a6e22e>vec3</span> <span style=color:#a6e22e>texel</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>g</span>), <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>b</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>lightness</span>(<span style=color:#a6e22e>vec3</span> <span style=color:#a6e22e>texel</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>mx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>g</span>), <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>b</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> <span style=color:#a6e22e>mn</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>g</span>), <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>b</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>mx</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>mn</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>2.0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>luma</span>(<span style=color:#a6e22e>vec3</span> <span style=color:#a6e22e>texel</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0.299</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>r</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.587</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>g</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.114</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>texel</span>.<span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Las fórmulas se tomaron de la sección <a href=https://en.wikipedia.org/wiki/HSL_and_HSV#Disadvantages>Lightness</a> en la página con es tema de los modelos HSL y HSV.</p><ol start=3><li>Para las herramientas de detalle tenemos por una lado la de magnificación, para este se usan los parámetros de <code>tiling</code> y <code>offset</code>, los cuales nos dan información sobre cuanto se debe agrandar la imagen (que corresponde al zoom) y cuando se debe desplazar para compensar en cambio de distancia al agrandar la imagen. Este último se calcula antes de pasar al shader, ya que se necesita el tamaño del canvas para calcular en <em>offset</em> ideal. Con estos valores, simplemente en vez de pasar como parámetro <code>vTexCoord</code> a la función <code>applyMask</code>, se pasa la coordenada multiplicada por el <em>tiling</em> y sumada con el <em>offset</em>.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>color_mask</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>applyMask</span>(<span style=color:#a6e22e>vTexCoord</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>tiling</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>offset</span>);
</span></span></code></pre></div><p>Para entender lo anterior se tomó como referencia <a href=https://gamedevserj.github.io/godot-magnifying-glass-tutorial.html>Magnifying glass shader</a>. Por otro lado, tenemos la región de interés, para esta usamos una región circular de radio <code>radius</code> definida por el usuario y dada la posición <code>mousePos</code>. Para esto usamos la función <code>distance</code> para calcular la distancia entre el mouse y el la coordenada del pixel actual, luego restamos el radio y ajustamos el resultado a valores entre 0 y 1. Finalmente, utilizamos la función <code>mix(x, y, a)</code> de GLSL que realiza una interpolación lineal entre los pixeles de la textura original <em>x</em> y los pixeles de la textura modificada <em>y</em> utilizando un a peso dado por <code>mixAmount</code> <em>a</em> entre ellas, el cual corresponde a la región de interés circular.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// en el main()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>dist</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>distance</span>(<span style=color:#a6e22e>mousePos</span>, <span style=color:#a6e22e>gl_FragCoord</span>.<span style=color:#a6e22e>xy</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>mixAmount</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>clamp</span>((<span style=color:#a6e22e>dist</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>radius</span>) , <span style=color:#ae81ff>0.</span>, <span style=color:#ae81ff>1.</span>);
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#a6e22e>gl_FragColor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mix</span>(<span style=color:#a6e22e>color_mask</span>, <span style=color:#a6e22e>color_normal</span>, <span style=color:#a6e22e>mixAmount</span>);
</span></span></code></pre></div><p>Este fragmento de código fué adaptado de <a href=https://stackoverflow.com/questions/45270803/webgl-shader-to-color-the-texture-according-to-mouse-position>WebGL shader to color the texture according to mouse position</a>.</p></div></details></p></div></blockquote><h2 id=conclusión>Conclusión
<a class=anchor href=#conclusi%c3%b3n>#</a></h2><blockquote><div style=text-align:justify>Existen numerosas herramientas para el procesamiento de imágenes. Entre estas algunas de las más conocidas incluyen las máscaras de convolución, que tiene funciones como mejorar la nitidez o detectar los bordes de una imagen. Herramientas de magnificación y región de interés que nos permine ver una sección de la imagen aumentada o aplicar la máscara solo en una parte de la imagen. Herramientas de brillo como la opción de _value_ basada en el modelo HSV que da la imagen más luminosidad en partes donde los colores son más claros/ brillantes o la opción de `luma` que da un mejor balance sobre el brillo de una imagen. Todas estas herramientas nos permiten tener imágenes más vistosas, nítidas, que nos permiten ver detalles que tal vez no se pueden ver en la imagen original. Estas son de gran utilidad en distintos campos como el de la medicina donde las imágenes que se obtienen no son tan claras como las imágenes que se toman con una cámara.</div><h3 id=trabajo-futuro>Trabajo Futuro
<a class=anchor href=#trabajo-futuro>#</a></h3><div style=text-align:justify>Actualmente, existen muchas más herramientas para el procesamiento de imágen. Aunque se implementaron algunas de las máscaras más conocidas, existe una gran variedad de máscaras de convolución que permiten crear otros efectos que realzan otras características del color en una imagen, por lo cual sería bueno más adelante implementar más opciones de máscara, con matrices de tamaños mayores, y dar la posibilidad al usuario de definir sus propias máscaras. Por otro lado, en cuanto a las herramientas de detalla, sería bueno implementar otros tipos de lupa, además de dar opciones de escoger la forma del ROI, tal vez que el usuario pueda trazar manualmente la zona que desea modificar. Además, dentro de las herramientas de luminosidad existen otros modos que se pueden estudiar, además que la implementación que se realizó da una imagen en escala de grises, por lo que sería bueno investigar un poco más sobre cómo se pueden obtener un resultado para generar imágenes a color de forma que la luminosidad sea más evidente respecto a la imagen original.</br><p align=center><img src=/showcase/img/trabajofuturo.png alt width=400px><br>Fig.6 - más herramientas de procesamiento de imágenes</p></div></blockquote><h2 id=referencias>Referencias
<a class=anchor href=#referencias>#</a></h2><ol><li>Wikipedia contributors. &ldquo;Digital image processing&rdquo;. Tomado de <a href=https://en.wikipedia.org/wiki/Digital_image_processing>https://en.wikipedia.org/wiki/Digital_image_processing</a></li><li>Poweel, Victor. &ldquo;Image Kernels&rdquo;. Tomado de <a href=https://setosa.io/ev/image-kernels/>https://setosa.io/ev/image-kernels/</a></li><li>Charalambos, Jean Pierre. &ldquo;Procedural Texturing&rdquo;. Tomado de <a href=https://visualcomputing.github.io/docs/shaders/procedural_texturing/>https://visualcomputing.github.io/docs/shaders/procedural_texturing/</a></li></ol></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/visualcomputing/showcase/commit/82bcae04bc825cca246ba59436f14be3e4528bdd title='Last modified by jorodriguezal | June 17, 2023' target=_blank rel=noopener><img src=/showcase/svg/calendar.svg class=book-icon alt=Calendar>
<span>June 17, 2023</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#procesamiento-de-imágenes-y-máscaras>Procesamiento de Imágenes y máscaras</a><ul><li><a href=#introducción>Introducción</a><ul><li><a href=#antecedentes-y-trabajo-previo>Antecedentes y trabajo previo</a></li></ul></li><li><a href=#ejercicio>Ejercicio</a><ul><li><a href=#solución>Solución</a></li><li><a href=#código>Código</a></li></ul></li><li><a href=#conclusión>Conclusión</a><ul><li><a href=#trabajo-futuro>Trabajo Futuro</a></li></ul></li><li><a href=#referencias>Referencias</a></li></ul></li></ul></nav></div></aside></main></body></html>